version: 1
frontend:
    phases:
      preBuild:
        commands:
          # Install modules 
          - cd Client
          - npm install
          - cd ../ClientRNApp
          - npm install
      build:
        commands:
          # Create a folder "builds" to store all the build files
          - cd ..
          - mkdir -p builds/control

          # Build Client control page and copy over another folder
          - cd Client
          - npm run build
          - cp -r dist/* ../builds/control/
          - rm -r dist

          # Build Client home page
          - cd ../ClientRNApp
          - npx expo export -p web
          - cp -r dist/* ../builds/
          - rm -r dist

    artifacts:
        baseDirectory:
          - if [ "${AWS_APP_ID}" = "your-control-app-id" ]; then echo "builds/control" ; fi
          - if [ "${AWS_APP_ID}" = "your-home-app-id" ]; then echo "builds" ; fi
        files:
          - '**/*'
    cache:
        paths:
          - Client/node_modules/**/*
          - ClientRNApp/node_modules/**/*
    redirects:
      - source: /control/<*>  # Route all requests starting with /control to the control page
        target: /control/<*> 
        status: 200

      - source: /              # Default route to home page
        target: /index.html
        status: 200